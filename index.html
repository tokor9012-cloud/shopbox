<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spaceman Pro - Audio & Full Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; overflow: hidden; }
        .bg-space { background: radial-gradient(circle at center, #2e1065 0%, #0f172a 100%); }
        #gameCanvas { width: 100%; height: 320px; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .crash-text { animation: shake 0.5s infinite; color: #ef4444 !important; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -2px); } 100% { transform: translate(1px, -1px); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-space h-screen flex flex-col">

    <div id="adminModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/90">
        <div class="glass w-full max-w-md p-6 rounded-3xl border-2 border-yellow-500">
            <h2 class="text-xl font-black text-yellow-500 mb-4 italic text-center">PANEL KONTROL</h2>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] text-gray-400 font-bold">TARGET MELEDAK (X)</label>
                    <input type="number" id="targetInput" value="2.50" step="0.01" class="w-full bg-gray-900 text-yellow-400 p-3 rounded-xl border border-gray-700 font-mono text-xl outline-none">
                </div>
                <div>
                    <label class="text-[10px] text-gray-400 font-bold">ISI SALDO (RP)</label>
                    <input type="number" id="balanceInput" placeholder="Masukkan angka..." class="w-full bg-gray-900 text-white p-3 rounded-xl border border-gray-700 font-mono outline-none">
                </div>
                <button onclick="saveAdmin()" class="w-full py-4 bg-yellow-600 text-black font-black rounded-2xl shadow-lg uppercase">Update System</button>
                <button onclick="closeAdmin()" class="w-full py-2 text-gray-500 text-xs italic">Tutup Panel</button>
            </div>
        </div>
    </div>

    <header class="p-4 flex justify-between items-center">
        <button onclick="openAdmin()" class="w-10 h-10 flex items-center justify-center bg-white/10 rounded-full border border-white/20">
            <i class="fas fa-cog text-gray-300"></i>
        </button>
        <div class="bg-black/40 px-5 py-1.5 rounded-full border border-blue-500/50">
            <span class="text-blue-400 text-xs font-bold">Rp</span>
            <span id="balanceText" class="font-bold text-sm tracking-widest ml-1">1.071,89</span>
        </div>
        <div class="w-10 h-10 rounded-full border border-emerald-500 overflow-hidden">
            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Robot" alt="avatar">
        </div>
    </header>

    <div class="relative flex-grow flex flex-col items-center justify-center">
        <div id="displayMult" class="text-7xl font-black text-white z-10 drop-shadow-2xl">1.00x</div>
        <p id="statusLabel" class="text-[10px] uppercase tracking-[0.4em] text-blue-300 mt-2 font-black">Tunggu Permainan...</p>
        <canvas id="gameCanvas" class="absolute inset-0"></canvas>
        <div id="historyBar" class="absolute bottom-10 left-0 w-full flex gap-2 px-6 overflow-x-auto no-scrollbar"></div>
    </div>

    <footer class="bg-[#1e1b4b] p-6 rounded-t-[40px] shadow-2xl">
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="glass p-3 rounded-2xl">
                <p class="text-[9px] text-gray-500 font-black uppercase">Cairkan Otomatis</p>
                <div class="flex justify-between font-bold mt-1"><span>2.00x</span><i class="fas fa-chevron-right text-gray-700 text-xs"></i></div>
            </div>
            <div class="glass p-3 rounded-2xl">
                <p class="text-[9px] text-gray-500 font-black uppercase">Taruhan (Rp)</p>
                <input type="number" id="betInput" value="2000" class="w-full bg-transparent font-bold mt-1 text-yellow-500 outline-none border-none p-0">
            </div>
        </div>
        <button id="actionBtn" onclick="handleAction()" class="w-full py-5 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl text-xl font-black shadow-xl uppercase tracking-widest transition-all">
            Pasang Taruhan
        </button>
    </footer>

    <audio id="flySound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3" loop></audio>
    <audio id="crashSound" src="https://assets.mixkit.co/active_storage/sfx/123/123-preview.mp3"></audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const displayMult = document.getElementById('displayMult');
        const actionBtn = document.getElementById('actionBtn');
        const historyBar = document.getElementById('historyBar');
        const flySound = document.getElementById('flySound');
        const crashSound = document.getElementById('crashSound');

        let balance = 1071.89;
        let targetCrash = 2.50;
        let currentMult = 1.00;
        let isPlaying = false; // Permainan sedang berjalan
        let hasCashedOut = false; // Pemain sudah ambil uang atau belum
        let animation;
        let robotPos = { x: 50, y: 250 };
        let history = ["5.13x", "1.06x", "1.43x", "2.53x"];

        canvas.width = window.innerWidth;
        canvas.height = 320;

        function drawRobot(x, y, state) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.setLineDash([5, 5]);
            ctx.moveTo(0, 300);
            ctx.quadraticCurveTo(canvas.width/2, 300, x, y);
            ctx.strokeStyle = state === 'crash' ? '#ef4444' : '#60a5fa';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Robot Body (State based color)
            ctx.fillStyle = (state === 'crash') ? '#ef4444' : '#ffffff';
            ctx.beginPath(); ctx.arc(x, y, 12, 0, Math.PI*2); ctx.fill(); // Head
            ctx.fillStyle = '#1e293b'; ctx.fillRect(x-7, y-4, 14, 6); // Visor
            ctx.fillStyle = (state === 'win') ? '#10b981' : '#3b82f6'; ctx.fillRect(x-10, y+12, 20, 18); // Body
            
            if(state === 'flying' || state === 'win') {
                ctx.fillStyle = '#f59e0b'; // Fire
                ctx.beginPath(); ctx.moveTo(x-6, y+30); ctx.lineTo(x, y+45); ctx.lineTo(x+6, y+30); ctx.fill();
            }
        }

        function handleAction() {
            if (!isPlaying) {
                startGame();
            } else if (!hasCashedOut) {
                cashOut();
            }
        }

        function startGame() {
            const betVal = parseFloat(document.getElementById('betInput').value);
            if(balance < betVal/1000) return alert("Saldo tidak cukup!");
            
            isPlaying = true;
            hasCashedOut = false;
            balance -= (betVal/1000);
            updateUI();
            
            currentMult = 1.00;
            robotPos = { x: 50, y: 250 };
            
            actionBtn.innerText = "Cash Out";
            actionBtn.className = "w-full py-5 bg-gradient-to-r from-orange-500 to-red-600 rounded-2xl text-xl font-black shadow-xl uppercase";
            document.getElementById('statusLabel').innerText = "Terbang...";
            
            flySound.currentTime = 0;
            flySound.play();
            animate();
        }

        function animate() {
            if (currentMult >= targetCrash) {
                crashGame();
                return;
            }

            currentMult += 0.01;
            displayMult.innerText = currentMult.toFixed(2) + "x";
            
            robotPos.x += (canvas.width / (targetCrash * 100)) * 0.8;
            robotPos.y -= (220 / (targetCrash * 100)) * 0.8;

            drawRobot(robotPos.x, robotPos.y, hasCashedOut ? 'win' : 'flying');
            animation = requestAnimationFrame(animate);
        }

        function cashOut() {
            const betVal = parseFloat(document.getElementById('betInput').value);
            const win = (betVal/1000) * currentMult;
            balance += win;
            hasCashedOut = true;
            
            updateUI();
            actionBtn.innerText = "Sudah Cair";
            actionBtn.disabled = true;
            actionBtn.className = "w-full py-5 bg-gray-700 rounded-2xl text-xl font-black opacity-50 uppercase";
            document.getElementById('statusLabel').innerText = "Berhasil Mengambil!";
            // Robot tetap lanjut terbang di fungsi animate (state 'win')
        }

        function crashGame() {
            isPlaying = false;
            flySound.pause();
            crashSound.play();
            cancelAnimationFrame(animation);
            
            displayMult.classList.add('crash-text');
            document.getElementById('statusLabel').innerText = "CRASHED!";
            drawRobot(robotPos.x, robotPos.y, 'crash');
            
            addHistory(currentMult.toFixed(2) + "x");
            setTimeout(resetGame, 3000);
        }

        function resetGame() {
            displayMult.innerText = "1.00x";
            displayMult.className = "text-7xl font-black text-white z-10 drop-shadow-2xl";
            actionBtn.disabled = false;
            actionBtn.innerText = "Pasang Taruhan";
            actionBtn.className = "w-full py-5 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl text-xl font-black shadow-xl uppercase";
            document.getElementById('statusLabel').innerText = "Tunggu Permainan...";
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawRobot(50, 250, 'idle');
        }

        function addHistory(val) {
            history.unshift(val);
            if(history.length > 5) history.pop();
            renderHistory();
        }

        function renderHistory() {
            historyBar.innerHTML = '';
            history.forEach(item => {
                const v = parseFloat(item);
                let color = "bg-blue-600/30 border-blue-500 text-blue-400";
                if(v >= 2) color = "bg-purple-600/30 border-purple-500 text-purple-400";
                const span = document.createElement('span');
                span.className = `${color} border px-3 py-1 rounded-lg text-[10px] font-bold`;
                span.innerText = item;
                historyBar.appendChild(span);
            });
        }

        function updateUI() { document.getElementById('balanceText').innerText = balance.toLocaleString('id-ID', {minimumFractionDigits: 2}); }
        function openAdmin() { document.getElementById('adminModal').classList.remove('hidden'); }
        function closeAdmin() { document.getElementById('adminModal').classList.add('hidden'); }
        function saveAdmin() {
            targetCrash = parseFloat(document.getElementById('targetInput').value);
            const extra = document.getElementById('balanceInput').value;
            if(extra) { balance = parseFloat(extra); updateUI(); }
            closeAdmin();
        }

        renderHistory();
        updateUI();
        drawRobot(50, 250, 'idle');
    </script>
</body>
    </html>
